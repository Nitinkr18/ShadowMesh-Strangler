<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            padding: 40px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 48px; }
        header h1 {
            font-size: 32px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        header p { color: #86868b; margin-top: 8px; font-size: 14px; }
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        @media (max-width: 1024px) { .grid { grid-template-columns: 1fr; } }
        .card {
            background: #1d1d1f;
            border-radius: 18px;
            padding: 28px;
            border: 1px solid #2d2d2d;
        }
        .card-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 24px;
        }
        .icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .icon.healer { background: linear-gradient(135deg, #ff6b6b, #ee5a5a); }
        .icon.guardian { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .icon.verifier { background: linear-gradient(135deg, #fa709a, #fee140); }
        .card-header h2 { font-size: 17px; font-weight: 600; }
        .card-header span { font-size: 12px; color: #86868b; display: block; margin-top: 2px; }
        .status {
            margin-left: auto;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 10px;
            border-radius: 6px;
        }
        .status.active { background: rgba(52, 199, 89, 0.2); color: #34c759; }
        .status.idle { background: rgba(142, 142, 147, 0.2); color: #8e8e93; }
        .metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        .metric {
            background: #000;
            border-radius: 12px;
            padding: 14px;
            text-align: center;
        }
        .metric-value { font-size: 22px; font-weight: 600; }
        .metric-label { font-size: 10px; color: #86868b; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px; }
        .section { margin-bottom: 16px; }
        .section-header {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #86868b;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .dot { width: 6px; height: 6px; border-radius: 50%; }
        .dot.input { background: #ff9f0a; }
        .dot.think { background: #bf5af2; }
        .dot.decide { background: #0a84ff; }
        .dot.action { background: #30d158; }
        .content {
            background: #000;
            border-radius: 10px;
            padding: 14px;
            font-size: 13px;
            line-height: 1.5;
            color: #d1d1d6;
            max-height: 80px;
            overflow-y: auto;
        }
        .content.expandable { cursor: pointer; }
        .content.collapsed { max-height: 44px; overflow: hidden; }
        .content::-webkit-scrollbar { width: 4px; }
        .content::-webkit-scrollbar-thumb { background: #3a3a3c; border-radius: 2px; }
        .empty { color: #48484a; font-style: italic; }
        .footer {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid #2d2d2d;
            font-size: 11px;
            color: #48484a;
            display: flex;
            justify-content: space-between;
        }
        .live-indicator {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #1d1d1f;
            border: 1px solid #2d2d2d;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 12px;
            color: #86868b;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .pulse {
            width: 8px;
            height: 8px;
            background: #30d158;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.9); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AI Agent Dashboard</h1>
            <p>Real-time monitoring of autonomous agents powered by Llama 3.1</p>
        </header>
        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <div class="icon healer">‚ù§Ô∏è‚Äçü©π</div>
                    <div>
                        <h2>Pipeline Healer</h2>
                        <span>Debezium CDC Monitor</span>
                    </div>
                    <div class="status active" id="healer-status">Active</div>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="healer-checks">0</div>
                        <div class="metric-label">Checks</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="healer-heals">0</div>
                        <div class="metric-label">Heals</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="healer-connector">‚Äî</div>
                        <div class="metric-label">Status</div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot input"></span>Input</div>
                    <div class="content expandable collapsed" id="healer-input" onclick="toggle(this)">Awaiting data...</div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot think"></span>Thinking</div>
                    <div class="content" id="healer-thinking">Awaiting data...</div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot decide"></span>Decision</div>
                    <div class="content" id="healer-decision">Awaiting data...</div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot action"></span>Action</div>
                    <div class="content" id="healer-action">None</div>
                </div>
                <div class="footer">
                    <span>Last check</span>
                    <span id="healer-time">‚Äî</span>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="icon guardian">üõ°Ô∏è</div>
                    <div>
                        <h2>Traffic Guardian</h2>
                        <span>Latency-based Router</span>
                    </div>
                    <div class="status active" id="guardian-status">Active</div>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="guardian-latency">0<span style="font-size:12px">ms</span></div>
                        <div class="metric-label">Latency</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="guardian-weight">0<span style="font-size:12px">%</span></div>
                        <div class="metric-label">Weight</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="guardian-shifts">0</div>
                        <div class="metric-label">Shifts</div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot input"></span>Input</div>
                    <div class="content expandable collapsed" id="guardian-input" onclick="toggle(this)">Awaiting data...</div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot think"></span>Thinking</div>
                    <div class="content" id="guardian-thinking">Awaiting data...</div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot decide"></span>Decision</div>
                    <div class="content" id="guardian-decision">Awaiting data...</div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot action"></span>Action</div>
                    <div class="content" id="guardian-action">None</div>
                </div>
                <div class="footer">
                    <span>Last check</span>
                    <span id="guardian-time">‚Äî</span>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="icon verifier">üîç</div>
                    <div>
                        <h2>Integrity Verifier</h2>
                        <span>Data Sync Validator</span>
                    </div>
                    <div class="status active" id="verifier-status">Active</div>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="verifier-compared">0</div>
                        <div class="metric-label">Compared</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="verifier-mismatches">0</div>
                        <div class="metric-label">Mismatches</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="verifier-syncs">0</div>
                        <div class="metric-label">Syncs</div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot input"></span>Input</div>
                    <div class="content expandable collapsed" id="verifier-input" onclick="toggle(this)">Awaiting data...</div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot think"></span>Thinking</div>
                    <div class="content" id="verifier-thinking">Awaiting data...</div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot decide"></span>Decision</div>
                    <div class="content" id="verifier-decision">Awaiting data...</div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="dot action"></span>Action</div>
                    <div class="content" id="verifier-action">None</div>
                </div>
                <div class="footer">
                    <span>Last check</span>
                    <span id="verifier-time">‚Äî</span>
                </div>
            </div>
        </div>
    </div>
    <div class="live-indicator">
        <span class="pulse"></span>
        Live
    </div>
    <script>
        function toggle(el) {
            el.classList.toggle('collapsed');
        }
        function set(id, val, fallback = '‚Äî') {
            const el = document.getElementById(id);
            if (el) {
                const v = val !== null && val !== undefined && val !== '' ? val : fallback;
                el.textContent = v;
                el.classList.toggle('empty', !val);
            }
        }
        function time(iso) {
            if (!iso) return '‚Äî';
            return new Date(iso).toLocaleTimeString();
        }
        async function refresh() {
            try {
                const res = await fetch('/api/agents/state');
                const data = await res.json();
                if (!data.success) return;
                const h = data.agents.pipeline_healer;
                const g = data.agents.traffic_guardian;
                const v = data.agents.integrity_verifier;
                set('healer-checks', h.checks_performed);
                set('healer-heals', h.heals_performed);
                set('healer-connector', h.connector_status);
                set('healer-input', h.llm_input, 'No prompt yet');
                set('healer-thinking', h.thinking, 'Awaiting data...');
                set('healer-decision', h.decision, 'Awaiting data...');
                set('healer-action', h.action_taken, 'None');
                set('healer-time', time(h.last_check));
                document.getElementById('healer-status').className = 'status ' + (h.status === 'running' ? 'active' : 'idle');
                document.getElementById('healer-status').textContent = h.status === 'running' ? 'Active' : 'Idle';
                set('guardian-latency', Math.round(g.latency_ms || 0));
                set('guardian-weight', g.current_weight || 0);
                set('guardian-shifts', g.traffic_shifts);
                set('guardian-input', g.llm_input, 'No prompt yet');
                set('guardian-thinking', g.thinking, 'Awaiting data...');
                set('guardian-decision', g.decision, 'Awaiting data...');
                set('guardian-action', g.action_taken, 'None');
                set('guardian-time', time(g.last_check));
                document.getElementById('guardian-status').className = 'status ' + (g.status === 'running' ? 'active' : 'idle');
                document.getElementById('guardian-status').textContent = g.status === 'running' ? 'Active' : 'Idle';
                set('verifier-compared', v.records_compared);
                set('verifier-mismatches', v.mismatches_found);
                set('verifier-syncs', v.force_syncs);
                set('verifier-input', v.llm_input, 'No prompt yet');
                set('verifier-thinking', v.thinking, 'Awaiting data...');
                set('verifier-decision', v.decision, 'Awaiting data...');
                set('verifier-action', v.action_taken, 'None');
                set('verifier-time', time(v.last_check));
                document.getElementById('verifier-status').className = 'status ' + (v.status === 'running' ? 'active' : 'idle');
                document.getElementById('verifier-status').textContent = v.status === 'running' ? 'Active' : 'Idle';
            } catch (e) { console.error(e); }
        }
        refresh();
        setInterval(refresh, 3000);
    </script>
</body>
</html>
